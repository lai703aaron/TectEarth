<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoDrift: 3D Earth Evolution Simulator</title>
  
  <!-- CDNs -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #000; font-family: system-ui, sans-serif; color: white; }
    #container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    .ui {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); padding: 20px 30px; border-radius: 20px;
      text-align: center; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      z-index: 100; max-width: 90%;
    }
    h1 { font-size: 2.5em; background: linear-gradient(90deg, #ff8a00, #da1b60); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
    #timeLabel { font-size: 1.5em; margin: 15px 0; color: #00ffcc; font-weight: bold; }
    #timeSlider { width: 100%; height: 12px; border-radius: 6px; background: #333; outline: none; margin: 20px 0; }
    #timeSlider::-webkit-slider-thumb { appearance: none; width: 28px; height: 28px; border-radius: 50%; background: #ff6b00; cursor: pointer; box-shadow: 0 0 15px #ff6b00; }
    .buttons button { margin: 10px; padding: 12px 24px; background: #ff6b00; color: white; border: none; border-radius: 30px; cursor: pointer; transition: all 0.3s; }
    .buttons button:hover { background: #ff8a00; transform: scale(1.1); }
    .info { margin-top: 15px; font-size: 0.9em; opacity: 0.9; }
  </style>
</head>
<body>
  <div id="container"></div>
  
  <div class="ui">
    <h1>GeoDrift</h1>
    <p id="timeLabel">現在 (0 Ma)</p>
    <input type="range" id="timeSlider" min="-600" max="250" value="0" step="5"/>
    <div class="buttons">
      <button id="playBtn">播放動畫</button>
      <button id="resetBtn">回到現在</button>
    </div>
    <p class="info">從 6 億年前到未來 2.5 億年，見證盤古大陸的誕生與消亡！</p>
  </div>

  <script>
    let scene, camera, renderer, earth, controls;
    let isPlaying = false;
    let direction = 1;

    const textures = {
      "-600": "https://i.imgur.com/2f5mK8J.jpg",
      "-540": "https://i.imgur.com/8Y3vXpL.jpg",
      "-450": "https://i.imgur.com/QkR8mP0.jpg",
      "-335": "https://i.imgur.com/X7pL9sN.jpg",
      "-250": "https://i.imgur.com/4r9vZkE.jpg",
      "-200": "https://i.imgur.com/J8sL2pX.jpg",
      "-150": "https://i.imgur.com/oP7nR5v.jpg",
      "-100": "https://i.imgur.com/W2kX9mZ.jpg",
      "-50":  "https://i.imgur.com/9tY5vHq.jpg",
      "0":    "https://i.imgur.com/0vL8g7P.jpg",
      "50":   "https://i.imgur.com/L5pR9kD.jpg",
      "100":  "https://i.imgur.com/H3mX2vN.jpg",
      "250":  "https://i.imgur.com/Z9kP7wQ.jpg"
    };

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000814);

      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 0, 3.5);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('container').appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      const geometry = new THREE.SphereGeometry(1.5, 128, 128);
      const material = new THREE.MeshPhongMaterial({
        map: new THREE.TextureLoader().load(textures["0"]),
        bumpScale: 0.05,
        specular: new THREE.Color(0x333333),
        shininess: 15
      });
      earth = new THREE.Mesh(geometry, material);
      scene.add(earth);

      const ambientLight = new THREE.AmbientLight(0x404040);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
      directionalLight.position.set(5, 3, 5);
      scene.add(directionalLight);

      const slider = document.getElementById('timeSlider');
      slider.addEventListener('input', (e) => updateEarth(parseInt(e.target.value)));

      document.getElementById('playBtn').addEventListener('click', () => {
        isPlaying = !isPlaying;
        document.getElementById('playBtn').textContent = isPlaying ? "暫停" : "播放動畫";
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        slider.value = 0;
        updateEarth(0);
        isPlaying = false;
        document.getElementById('playBtn').textContent = "播放動畫";
      });

      window.addEventListener('resize', onWindowResize);
    }

    function updateEarth(ma) {
      const keys = Object.keys(textures).map(Number).sort((a,b)=>a-b);
      let closest = keys[0];
      for (let key of keys) {
        if (Math.abs(key - ma) < Math.abs(closest - ma)) closest = key;
      }

      new THREE.TextureLoader().load(textures[closest], (tex) => {
        earth.material.map = tex;
        earth.material.needsUpdate = true;
      });

      const label = ma < 0 ? `${Math.abs(ma)} 百萬年前` : ma > 0 ? `未來 ${ma} 百萬年` : "現在";
      document.getElementById('timeLabel').textContent = label;
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();

      if (isPlaying) {
        let current = parseInt(document.getElementById('timeSlider').value);
        current += direction * 2;
        if (current >= 250 || current <= -600) direction *= -1;
        document.getElementById('timeSlider').value = current;
        updateEarth(current);
      }

      earth.rotation.y += 0.002;
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
  </script>
</body>
</html>
