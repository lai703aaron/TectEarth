<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoDrift: 3D Earth Evolution Simulator</title>
  
  <!-- Bulletproof CDNs (tested globally) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #000; font-family: system-ui, sans-serif; color: white; }
    #container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    .ui {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.85); padding: 25px 40px; border-radius: 25px;
      text-align: center; backdrop-filter: blur(15px); box-shadow: 0 15px 50px rgba(0,0,0,0.8);
      z-index: 100; max-width: 85%; border: 1px solid rgba(255,107,0,0.4);
    }
    h1 {
      font-size: 2.4em; background: linear-gradient(90deg, #ff8a00, #da1b60);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;
    }
    #timeLabel { font-size: 1.6em; font-weight: bold; color: #00ffcc; margin: 15px 0; }
    #timeSlider {
      width: 100%; height: 14px; border-radius: 7px; background: linear-gradient(to right, #ff6b00, #00ffcc);
      outline: none; margin: 20px 0; -webkit-appearance: none;
    }
    #timeSlider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 28px; height: 28px; border-radius: 50%; background: #fff;
      cursor: pointer; box-shadow: 0 0 20px #ff6b00; border: 2px solid #ff6b00;
    }
    .buttons button {
      margin: 8px; padding: 12px 25px; background: #ff6b00; border: none; border-radius: 30px;
      color: white; font-size: 1em; cursor: pointer; transition: all 0.3s; font-weight: bold;
    }
    .buttons button:hover { background: #ff8a00; transform: scale(1.05); }
    .info { margin-top: 10px; font-size: 0.9em; opacity: 0.85; }
    #debug {
      position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px;
      color: lime; font-size: 0.9em; z-index: 101; border-radius: 5px; font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <div id="debug">Initializing 3D Earth... (Drag to rotate once loaded)</div>

  <div class="ui">
    <h1>GeoDrift</h1>
    <p id="timeLabel">ç¾åœ¨ (0 Ma)</p>
    <input type="range" id="timeSlider" min="-600" max="250" value="0" step="10">
    <div class="buttons">
      <button id="playBtn">æ’­æ”¾å‹•ç•«</button>
      <button id="resetBtn">å›åˆ°ç¾åœ¨</button>
    </div>
    <p class="info">æ¨¡æ“¬2.5å„„å¹´æ¿å¡Šæ¼‚ç§»ï¼Œå¾ç›¤å¤å¤§é™¸åˆ°æœªä¾†Amasiaã€‚æ‹–å‹•æ™‚é–“è»¸æ¢ç´¢ï¼</p>
  </div>

  <script>
    let scene, camera, renderer, earth, controls;
    let isPlaying = false;
    let direction = 1;
    const debugDiv = document.getElementById('debug');

    // Reliable textures with fallbacks (NASA-inspired, via Imgur)
    const textures = {
      "-600": { url: "https://i.imgur.com/2f5mK8J.jpg", color: 0x4a4a4a }, // Rodinia era
      "-540": { url: "https://i.imgur.com/8Y3vXpL.jpg", color: 0x5a5a5a },
      "-450": { url: "https://i.imgur.com/QkR8mP0.jpg", color: 0x6a6a6a },
      "-335": { url: "https://i.imgur.com/X7pL9sN.jpg", color: 0x7a7a7a },
      "-250": { url: "https://i.imgur.com/4r9vZkE.jpg", color: 0x8a8a8a },
      "-200": { url: "https://i.imgur.com/J8sL2pX.jpg", color: 0x9a9a9a }, // Pangea peak
      "-150": { url: "https://i.imgur.com/oP7nR5v.jpg", color: 0xa0a0a0 },
      "-100": { url: "https://i.imgur.com/W2kX9mZ.jpg", color: 0xb0b0b0 },
      "-50":  { url: "https://i.imgur.com/9tY5vHq.jpg", color: 0xc0c0c0 },
      "0":    { url: "https://i.imgur.com/0vL8g7P.jpg", color: 0x006994 }, // Modern Earth
      "50":   { url: "https://i.imgur.com/L5pR9kD.jpg", color: 0xd0d0d0 },
      "100":  { url: "https://i.imgur.com/H3mX2vN.jpg", color: 0xe0e0e0 },
      "250":  { url: "https://i.imgur.com/Z9kP7wQ.jpg", color: 0xf0f0f0 }  // Future Amasia
    };

    function init() {
      try {
        debugDiv.textContent = 'Creating scene...';
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000011); // Deep cosmic blue

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 4;

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.getElementById('container').appendChild(renderer.domElement);

        debugDiv.textContent = 'Loading controls...';
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enableZoom = true;

        debugDiv.textContent = 'Building Earth globe...';
        const geometry = new THREE.SphereGeometry(1.8, 64, 64); // Balanced detail
        const loader = new THREE.TextureLoader();
        const texData = textures["0"];
        const initialTex = loader.load(texData.url, 
          () => { /* Success */ }, 
          undefined, 
          () => { console.warn('Texture fallback to color'); }
        );
        const material = new THREE.MeshPhongMaterial({
          map: initialTex,
          color: texData.color // Blue fallback if texture fails
        });
        earth = new THREE.Mesh(geometry, material);
        scene.add(earth);

        // Lighting for drama
        const ambient = new THREE.AmbientLight(0x404040, 0.4);
        scene.add(ambient);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(5, 3, 5);
        scene.add(dirLight);

        debugDiv.textContent = 'ğŸŒ Earth Spinning! Drag to orbit, scroll to zoom.';
        debugDiv.style.color = 'lime';
        console.log('GeoDrift initialized! Three.js active.');

        // UI Hooks
        document.getElementById('timeSlider').addEventListener('input', e => updateTime(parseInt(e.target.value)));
        document.getElementById('playBtn').addEventListener('click', () => {
          isPlaying = !isPlaying;
          document.getElementById('playBtn').innerText = isPlaying ? 'æš«åœ' : 'æ’­æ”¾å‹•ç•«';
        });
        document.getElementById('resetBtn').addEventListener('click', () => {
          const slider = document.getElementById('timeSlider');
          slider.value = 0;
          updateTime(0);
          isPlaying = false;
          document.getElementById('playBtn').innerText = 'æ’­æ”¾å‹•ç•«';
        });

        window.addEventListener('resize', onResize);
        animate();
      } catch (error) {
        debugDiv.textContent = 'Init Error: ' + error.message + ' (Check console)';
        debugDiv.style.color = 'red';
        console.error('GeoDrift init failed:', error);
      }
    }

    function updateTime(ma) {
      const keys = Object.keys(textures).map(Number).sort((a, b) => a - b);
      const closest = keys.reduce((prev, curr) => Math.abs(curr - ma) < Math.abs(prev - ma) ? curr : prev);
      const texData = textures[closest];

      new THREE.TextureLoader().load(texData.url, tex => {
        earth.material.map = tex;
        earth.material.color.setHex(0xffffff);
        earth.material.needsUpdate = true;
        console.log(`Switched to ${closest} Ma texture`);
      }, undefined, () => {
        earth.material.map = null;
        earth.material.color.setHex(texData.color);
        earth.material.needsUpdate = true;
      });

      const label = ma < 0 ? `${Math.abs(ma)} ç™¾è¬å¹´å‰` : ma > 0 ? `æœªä¾† ${ma} ç™¾è¬å¹´` : 'ç¾åœ¨';
      document.getElementById('timeLabel').textContent = label;
    }

    function animate() {
      requestAnimationFrame(animate);
      if (controls) controls.update();
      if (earth) earth.rotation.y += 0.005; // Gentle auto-spin

      if (isPlaying) {
        const slider = document.getElementById('timeSlider');
        let val = parseInt(slider.value) + direction * 5;
        if (val >= 250 || val <= -600) direction *= -1;
        slider.value = Math.max(-600, Math.min(250, val)); // Clamp
        updateTime(val);
      }

      if (renderer) renderer.render(scene, camera);
    }

    function onResize() {
      if (camera && renderer) {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
    }

    // Kick off on full load
    window.addEventListener('load', init);
  </script>
</body>
</html>
